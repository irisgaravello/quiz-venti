<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Quale vento ti rappresenta?</title>
  <style>
    :root{
      --bg:#f7fbff;
      --card:#fff;
      --accent:#7fc7ff;
      --muted:#506b73;
      --text:#0f3a3f;
      --radius:12px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:var(--bg);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding:28px;
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:100vh;
    }
    .container{
      width:100%;
      max-width:820px;
      background:var(--card);
      border-radius:var(--radius);
      padding:22px;
      box-shadow:0 10px 30px rgba(16,49,58,0.06);
    }
    .header{text-align:center;margin-bottom:8px}
    .title{font-size:22px;font-weight:700;margin:0}
    .subtitle{margin-top:6px;color:var(--muted);font-size:14px}
    .question{border-radius:10px;padding:14px;margin:14px 0;background:#fbfeff;border:1px solid rgba(13,76,102,0.03)}
    .qtext{font-weight:600;margin-bottom:10px}
    .options{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .opt{
      padding:10px;border-radius:10px;border:1px solid transparent;background:transparent;text-align:left;cursor:pointer;transition:all .16s ease;font-size:14px;
    }
    .opt:hover{transform:translateY(-2px);box-shadow:0 6px 18px rgba(13,76,102,0.06)}
    .opt input{margin-right:8px}
    .footer{display:flex;justify-content:space-between;align-items:center;margin-top:10px}
    .btn{
      background:var(--accent);
      color:white;padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:700;
    }
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .counters{font-size:13px;color:var(--muted)}
    /* Result card */
    .result{max-width:720px;margin:0 auto;padding:20px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.75), rgba(255,255,255,0.9));box-shadow:0 8px 30px rgba(16,49,58,0.06);text-align:center;animation:fadeIn .45s ease}
    .result-emoji{font-size:48px;margin-bottom:8px}
    .result-name{font-size:20px;font-weight:700;margin-bottom:6px}
    .result-desc{color:#2e646c;margin-bottom:12px}
    .share{margin-top:10px;display:flex;gap:8px;justify-content:center}
    .small{font-size:13px;color:var(--muted)}
    @keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
    /* responsive */
    @media (max-width:640px){ .options{grid-template-columns:1fr} .title{font-size:18px} }
  </style>
</head>
<body>
  <main class="container" id="app" role="main">
    <header class="header">
      <h1 class="title">üå¨Ô∏è Quale vento ti rappresenta?</h1>
      <p class="subtitle">Rispondi a 10 domande su personalit√†, empatia e cura. Scopri il tuo vento.</p>
    </header>

    <form id="quizForm" aria-label="Quiz qualificativo">
      <!-- Questions will be injected here -->
      <div id="questions"></div>

      <div class="footer">
        <div class="counters" id="counter">Hai risposto a 0 / 10</div>
        <div>
          <button type="button" id="submitBtn" class="btn" disabled>Scopri il tuo vento</button>
        </div>
      </div>
    </form>

    <div id="resultArea" style="margin-top:18px"></div>
  </main>

  <script>
    (function(){
      // Winds definitions
      const WINDS = {
        tramontana: { name: 'Tramontana (N)', emoji: 'üß≠', description: 'Severo e freddo: disciplinato, forte e onesto. Cura gli altri con chiarezza e la distanza giusta; aiuta a vedere meglio e a preservare.', slug: 'tramontana' },
        grecale:   { name: 'Grecale (NE)', emoji: 'üå©Ô∏è', description: 'Deciso e a volte imprevedibile: determinato e relativamente intenso. Azione fredda e lucida ma affettuosa; osserva in silenzio e aiuta a prevedere le tempeste.', slug: 'grecale' },
        levante:   { name: 'Levante (E)', emoji: 'üåÖ', description: 'Porta la luce del risveglio: calma, paziente e delicata. Cura con perseveranza e semplicit√†; consola senza mai alzare la voce.', slug: 'levante' },
        scirocco:  { name: 'Scirocco (SE)', emoji: 'üî•', description: 'Ama il cambiamento: passionale e intensa, a volte opprimente. Non lascia mai solo; dona calore, fisicit√† e generosit√† emotiva.', slug: 'scirocco' },
        ostro:     { name: 'Ostro (S)', emoji: 'üå∏', description: 'Caldo e dolce: morbido e paziente. Si prende cura ascoltando, senza giudicare; fa germogliare il bello negli altri.', slug: 'ostro' },
        libeccio:  { name: 'Libeccio (SW)', emoji: '‚ö°', description: 'Tempestoso e vivace: rapido e instabile. Scuote gli altri e li difende con sincerit√† e protezione; odia la noia e le ingiustizie.', slug: 'libeccio' },
        ponente:   { name: 'Ponente (W)', emoji: 'üåô', description: 'Mite e moderato: amichevole e confortante. Amico leale e portatore di calma; la sua leggerezza fa bene al cuore.', slug: 'ponente' },
        maestrale: { name: 'Maestrale (NW)', emoji: 'üóª', description: 'Potente e orgoglioso: burrascoso e autoritario, ma rialza senza consolare. Dona forza e ricorda la potenza che hanno dentro.', slug: 'maestrale' }
      };

      // Questions array (10 questions)
      const QUESTIONS = [
        { id:'q1', text:'Quando qualcuno √® in difficolt√†, come reagisci?', options:[
          { id:'a', text:'Prendo il controllo e sistemo la situazione con ordine.', wind:'tramontana' },
          { id:'b', text:'Offro supporto caldo e rassicurante, stando vicino.', wind:'ostro' },
          { id:'c', text:'Mi metto in movimento, a volte con energia forte per proteggere.', wind:'libeccio' },
          { id:'d', text:'Ascolto in silenzio e aiuto con calma costante.', wind:'levante' }
        ]},
        { id:'q2', text:'Ti trovi a dover prendere una decisione difficile: cosa fai?', options:[
          { id:'a', text:'Valuto freddamente e decido con precisione.', wind:'grecale' },
          { id:'b', text:'Scelgo il cambiamento e seguo la passione.', wind:'scirocco' },
          { id:'c', text:'Cerco la via di mezzo per non turbare gli altri.', wind:'ponente' },
          { id:'d', text:'Imposto regole e disciplina per avere chiarezza.', wind:'tramontana' }
        ]},
        { id:'q3', text:'Ti piace provare cose nuove e avventure?', options:[
          { id:'a', text:'S√¨, cerco il brivido e l‚Äôazione rapida.', wind:'libeccio' },
          { id:'b', text:'S√¨, ma con attenzione e calcolo.', wind:'grecale' },
          { id:'c', text:'Preferisco piccoli cambiamenti dolci.', wind:'ostro' },
          { id:'d', text:'No: preferisco la routine e l‚Äôordine.', wind:'tramontana' }
        ]},
        { id:'q4', text:'Come mostri affetto agli altri?', options:[
          { id:'a', text:'Con gesti calorosi e fisicit√†.', wind:'scirocco' },
          { id:'b', text:'Con ascolto paziente e parole dolci.', wind:'ostro' },
          { id:'c', text:'Con consigli diretti e pratici.', wind:'tramontana' },
          { id:'d', text:'Con presenza discreta e leggerezza.', wind:'ponente' }
        ]},
        { id:'q5', text:'Quando senti che qualcosa non va nel gruppo, tu‚Ä¶', options:[
          { id:'a', text:'Prendo la leadership per sistemare le cose.', wind:'maestrale' },
          { id:'b', text:'Osservo e avverto prima che peggiori.', wind:'grecale' },
          { id:'c', text:'Cerco di alleviare le tensioni con dolcezza.', wind:'ostro' },
          { id:'d', text:'Propongo un cambiamento per scuotere le cose.', wind:'libeccio' }
        ]},
        { id:'q6', text:'Quale frase ti descrive meglio?', options:[
          { id:'a', text:'Calma e costante.', wind:'levante' },
          { id:'b', text:'Forte e autorevole.', wind:'maestrale' },
          { id:'c', text:'Appassionato e caloroso.', wind:'scirocco' },
          { id:'d', text:'Sincero e protettivo.', wind:'libeccio' }
        ]},
        { id:'q7', text:'Come ti rapporti con chi ha idee molto diverse dalle tue?', options:[
          { id:'a', text:'Cerco dialogo pacato e comprensione.', wind:'ponente' },
          { id:'b', text:'Spesso imposto i miei limiti con chiarezza.', wind:'tramontana' },
          { id:'c', text:'Mi adatto e trovo punti in comune.', wind:'ostro' },
          { id:'d', text:'Sfido le idee per scuotere lo status quo.', wind:'libeccio' }
        ]},
        { id:'q8', text:'Credi di poter ferire gli altri col tuo comportamento, anche se involontariamente?', options:[
          { id:'a', text:'S√¨, ma cerco sempre di rimediare con sincerit√†.', wind:'libeccio' },
          { id:'b', text:'S√¨, perch√© a volte la mia forza pu√≤ sembrare durezza.', wind:'maestrale' },
          { id:'c', text:'Forse, ma cerco di imparare e migliorare con calma.', wind:'levante' },
          { id:'d', text:'No, sto molto attento alle parole e ai gesti.', wind:'ostro' }
        ]},
        { id:'q9', text:'Quanto conta per te la disciplina e la chiarezza?', options:[
          { id:'a', text:'Molto: sono regole che salvano il gruppo.', wind:'tramontana' },
          { id:'b', text:'Abbastanza, ma non a scapito delle persone.', wind:'maestrale' },
          { id:'c', text:'Poco: preferisco flessibilit√† e calore.', wind:'ostro' },
          { id:'d', text:'Dipende: la uso quando serve cambiamento.', wind:'libeccio' }
        ]},
        { id:'q10', text:'In caso di necessit√†, ti viene spontaneo aiutare gli altri?', options:[
          { id:'a', text:'S√¨, √® la mia prima reazione: mi muovo subito.', wind:'libeccio' },
          { id:'b', text:'S√¨, ma lo faccio con calma e attenzione.', wind:'ostro' },
          { id:'c', text:'Solo se so di poter davvero essere utile.', wind:'grecale' },
          { id:'d', text:'Dipende: a volte preferisco dare forza a distanza.', wind:'tramontana' }
        ]}
      ];

      const questionsEl = document.getElementById('questions');
      const counterEl = document.getElementById('counter');
      const submitBtn = document.getElementById('submitBtn');
      const resultArea = document.getElementById('resultArea');

      // Build form UI
      QUESTIONS.forEach((q, qi) => {
        const section = document.createElement('section');
        section.className = 'question';
        section.id = q.id;

        const qtext = document.createElement('div');
        qtext.className = 'qtext';
        qtext.textContent = `Domanda ${qi+1}. ${q.text}`;
        section.appendChild(qtext);

        const opts = document.createElement('div');
        opts.className = 'options';

        q.options.forEach(opt => {
          const label = document.createElement('label');
          label.className = 'opt';
          label.tabIndex = 0;
          label.setAttribute('role','button');

          const input = document.createElement('input');
          input.type = 'radio';
          input.name = q.id;
          input.value = opt.id;
          input.style.marginRight = '8px';

          // For keyboard accessibility, allow space/enter on label
          label.addEventListener('keydown', (e) => {
            if(e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              input.checked = true;
              input.dispatchEvent(new Event('change', { bubbles:true }));
            }
          });

          input.addEventListener('change', () => {
            // attach selected wind to dataset on the label for visual toggling
            // remove selected class from all options of this question
            const siblings = opts.querySelectorAll('.opt');
            siblings.forEach(s => s.classList.remove('selected'));
            label.classList.add('selected');
            updateCounter();
          });

          label.appendChild(input);
          const span = document.createElement('span');
          span.textContent = opt.text;
          label.appendChild(span);
          opts.appendChild(label);
        });

        section.appendChild(opts);
        questionsEl.appendChild(section);
      });

      function updateCounter(){
        const total = QUESTIONS.length;
        let answered = 0;
        QUESTIONS.forEach(q => {
          const val = document.querySelector(`input[name="${q.id}"]:checked`);
          if(val) answered++;
        });
        counterEl.textContent = `Hai risposto a ${answered} / ${total}`;
        submitBtn.disabled = answered < total;
      }

      // submit logic
      submitBtn.addEventListener('click', () => {
        // ensure all answered
        const unanswered = QUESTIONS.filter(q => !document.querySelector(`input[name="${q.id}"]:checked`));
        if(unanswered.length > 0){
          if(!confirm(`Hai ${unanswered.length} domande senza risposta. Procedere comunque?`)) return;
        }
        // tally
        const tally = { tramontana:0, grecale:0, levante:0, scirocco:0, ostro:0, libeccio:0, ponente:0, maestrale:0 };
        QUESTIONS.forEach(q => {
          const checked = document.querySelector(`input[name="${q.id}"]:checked`);
          if(checked){
            const optId = checked.value;
            const opt = q.options.find(o => o.id === optId);
            if(opt && tally.hasOwnProperty(opt.wind)) tally[opt.wind] += 1;
          }
        });
        // pick winner: highest score, tiebreaker deterministic with priority order
        const priority = ['tramontana','grecale','levante','scirocco','ostro','libeccio','ponente','maestrale'];
        let max = -1;
        let winners = [];
        Object.keys(tally).forEach(k => {
          if(tally[k] > max){ max = tally[k]; winners = [k]; }
          else if(tally[k] === max) winners.push(k);
        });
        let winnerKey = winners.length === 1 ? winners[0] : (priority.find(p => winners.includes(p)) || winners[0]);
        showResult(winnerKey, tally);
      });

      function showResult(key, tally){
        const wind = WINDS[key];
        resultArea.innerHTML = '';
        const card = document.createElement('div');
        card.className = 'result';
        // emoji
        const emoji = document.createElement('div');
        emoji.className = 'result-emoji';
        emoji.textContent = wind.emoji;
        card.appendChild(emoji);
        // name
        const name = document.createElement('div');
        name.className = 'result-name';
        name.textContent = wind.name;
        card.appendChild(name);
        // description
        const desc = document.createElement('div');
        desc.className = 'result-desc';
        desc.textContent = wind.description;
        card.appendChild(desc);
        // scores grid
        const scoresWrap = document.createElement('div');
        scoresWrap.style.marginTop = '10px';
        scoresWrap.style.display = 'grid';
        scoresWrap.style.gridTemplateColumns = 'repeat(2,1fr)';
        scoresWrap.style.gap = '8px';
        Object.keys(tally).forEach(k => {
          const el = document.createElement('div');
          el.style.background = '#fbfeff';
          el.style.padding = '8px';
          el.style.borderRadius = '8px';
          el.style.border = '1px solid rgba(16,49,58,0.03)';
          el.style.display = 'flex';
          el.style.justifyContent = 'space-between';
          el.style.alignItems = 'center';
          const left = document.createElement('div');
          left.style.fontSize = '13px';
          left.textContent = WINDS[k].name;
          const right = document.createElement('div');
          right.style.fontWeight = '700';
          right.textContent = tally[k];
          el.appendChild(left);
          el.appendChild(right);
          scoresWrap.appendChild(el);
        });
        card.appendChild(scoresWrap);

        // share / restart buttons
        const shareWrap = document.createElement('div');
        shareWrap.className = 'share';
        shareWrap.style.marginTop = '14px';

        const shareBtn = document.createElement('button');
        shareBtn.className = 'btn';
        shareBtn.textContent = 'Condividi il risultato';
        shareBtn.addEventListener('click', () => {
          const url = `https://quizdeiventi.it/?risultato=${wind.slug}`;
          const text = `Il mio vento √® il ${wind.name} ${wind.emoji} ‚Äî ${wind.description} Scopri anche tu quale vento ti rappresenta: ${url}`;
          navigator.clipboard.writeText(text).then(() => {
            alert('Testo copiato negli appunti! Puoi incollarlo dove vuoi.');
          }).catch(() => {
            // fallback: show a textarea to manually copy
            showManualCopy(text);
          });
        });

        const restartBtn = document.createElement('button');
        restartBtn.className = 'btn';
        restartBtn.style.background = '#4b9ccf';
        restartBtn.textContent = 'Rifai il quiz';
        restartBtn.addEventListener('click', () => {
          // reset selections
          QUESTIONS.forEach(q => {
            const checked = document.querySelector(`input[name="${q.id}"]:checked`);
            if(checked) checked.checked = false;
          });
          // remove selected classes
          document.querySelectorAll('.opt').forEach(el => el.classList.remove('selected'));
          resultArea.innerHTML = '';
          document.getElementById('counter').textContent = `Hai risposto a 0 / ${QUESTIONS.length}`;
          document.getElementById('submitBtn').disabled = true;
          // scroll to top
          window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        shareWrap.appendChild(shareBtn);
        shareWrap.appendChild(restartBtn);
        card.appendChild(shareWrap);

        // small link text
        const small = document.createElement('div');
        small.className = 'small';
        small.style.marginTop = '10px';
        small.textContent = `Link condiviso: https://quizdeiventi.it/?risultato=${wind.slug}`;
        card.appendChild(small);

        resultArea.appendChild(card);
        // scroll to result
        card.scrollIntoView({behavior:'smooth', block:'center'});
      }

      function showManualCopy(text){
        const modal = document.createElement('div');
        modal.style.position='fixed';
        modal.style.left='0';modal.style.top='0';modal.style.right='0';modal.style.bottom='0';
        modal.style.background='rgba(0,0,0,0.35)';
        modal.style.display='flex';modal.style.alignItems='center';modal.style.justifyContent='center';
        const box = document.createElement('div');
        box.style.background='white';box.style.padding='16px';box.style.borderRadius='10px';box.style.maxWidth='600px';box.style.width='90%';
        const ta = document.createElement('textarea');
        ta.style.width='100%';ta.style.height='120px';
        ta.value = text;
        box.appendChild(ta);
        const ok = document.createElement('button');
        ok.textContent='Chiudi';
        ok.className='btn';
        ok.style.marginTop='8px';
        ok.addEventListener('click', ()=>document.body.removeChild(modal));
        box.appendChild(ok);
        modal.appendChild(box);
        document.body.appendChild(modal);
      }

      // initial counter
      updateCounter();

      // accessibility: prevent form submit on Enter
      document.getElementById('quizForm').addEventListener('submit', (e)=>e.preventDefault());

    })();
  </script>
</body>
</html>
